<div class="content">
  <mb-table-title [title]="'model.order.list' | translate"></mb-table-title>
  <!-- search -->
  <nz-table class="content mt-3">
    <div [formGroup]="formSearchOrder">
      <div class="row p-4">
        <div class="col-3 mb-2">
          <label>{{'model.order.type.root' | translate}}</label>
          <nz-select [nzNotFoundContent]="noDataResult" formControlName="purchaseType"
                     nzPlaceHolder="{{'model.order.type.root' | translate}}">
            <ng-container *ngFor="let type of types">
              <nz-option [nzValue]="type.value" [nzLabel]="type.label | translate"></nz-option>
            </ng-container>
          </nz-select>
        </div>
        <div class="col-3 mb-2">
          <label>{{'model.order.status.root' | translate}}</label>
          <nz-select
            formControlName="status"
            nzAllowClear
            appRemoveOptionTitle
            nzPlaceHolder="{{ 'model.order.selectStatus' | translate }}"
            
          >
            <nz-option
              *ngFor="let service of orderStatus"
              [nzLabel]="service.label | translate"
              [nzValue]="service.value"
              [nzCustomContent]="true"
            >
              <div
                container="body"
                [animation]="false"
                [openDelay]="100"
                [closeDelay]="0"
                [ngbTooltip]="service?.label! | translate"
              >
                {{ service?.label! | translate }}
              </div>
            </nz-option>
          </nz-select>
        </div>
        <div class="col-6">
          <label
            >{{ "model.product.price" | translate }}:
            <nz-input-number
              formControlName="startPrice"
              [nzMin]="minPrice"
              [nzMax]="this.orderSearchRequest.endPrice"
              [ngStyle]="{ margin: '0 16px', width: '35%' }"
              [nzFormatter]="formatterPrice"
              [nzParser]="parserPrice"
            >
            </nz-input-number>
            -->
            <nz-input-number
              formControlName="endPrice"
              [nzMin]="this.orderSearchRequest.startPrice"
              [nzMax]="maxPrice"
              [ngStyle]="{ marginLeft: '16px', width: '35%' }"
              [nzFormatter]="formatterPrice"
              [nzParser]="parserPrice"
            >
            </nz-input-number>
          </label>
          <nz-slider
            nzRange
            [nzMarks]="marks"
            formControlName="rangePrice"
            [nzMin]="minPrice"
            [nzMax]="maxPrice"
            (ngModelChange)="onChangeRangePrice()"
            [nzStep]="100"
            [nzTipFormatter]="formatterPrice"
          >
          </nz-slider>
        </div>
        <div class="col-3 mb-2">
          <label>{{'model.order.payMethod' | translate}}</label>
          <nz-select
            formControlName="payMethod"
            nzAllowClear
            appRemoveOptionTitle
            nzPlaceHolder="{{ 'model.order.payMethod' | translate }}"
          >
            <nz-option
              *ngFor="let service of payMethods"
              [nzLabel]="service.label | translate"
              [nzValue]="service.value"
              [nzCustomContent]="true"
            >
              <div
                container="body"
                [animation]="false"
                [openDelay]="100"
                [closeDelay]="0"
                [ngbTooltip]="service?.label! | translate"
              >
                {{ service?.label! | translate }}
              </div>
            </nz-option>
          </nz-select>
        </div>
        <div class="col-3 mb-2">
          <label>{{'model.order.orderer' | translate }}</label>
          <nz-select [nzNotFoundContent]="noDataResult"
           nzShowSearch nzServerSearch 
           class="pr-1"
                     formControlName="userId" 
                     appDebounceKeyUp (onEvent)="searchUsers($event)"
                     nzPlaceHolder="{{ 'model.order.orderer' | translate }}">
            <nz-option *ngFor="let user of users" [nzLabel]="user.fullName + ' - ' + user.phoneNumber " [nzValue]="user.userId"></nz-option>
          </nz-select>
        </div>
        <div class="col-6 mb-2">
          <label>{{'model.order.created.root' | translate}}</label>
          <app-date-range-picker [fromDate]="this.formSearchOrder?.get('startDate')?.value"
                                 [toDate]="this.formSearchOrder?.get('endDate')?.value" (rangeDateChange)="onChangeCreateDate($event)">
          </app-date-range-picker>
        </div>
      </div>
    </div>
    <div class="row pb-3 text-center">
      <div class="col-12">
        <button class="me-3" nz-button nzType="default" (click)="resetSearch()">
          {{ "action.reset" | translate }}
        </button>
        <button nz-button nzType="primary" (click)="search()">
          {{ "common.search" | translate }}
        </button>
      </div>
    </div>
  </nz-table>
  <!-- end-search -->
  <div class="col-12 text-end mt-3">
    <!-- <mb-button class="me-3" nz-button nz-dropdown [text]="'model.order.export'" (click)="openPurchasePopup()">
    </mb-button> -->
    <mb-button class="me-3" nz-button nz-dropdown [icon]="'plus'" [text]="'action.createOnline'" (click)="createOnline()"></mb-button>
    
    <mb-button nz-button nz-dropdown [icon]="'plus'" [text]="'action.create'" (click)="create()"></mb-button>
  </div>

  <div class="col-12 mt-2">
    <nz-table #table [nzData]="orders" [nzNoResult]="noDataResult"    (nzQueryParams)="onChangeQueryParam($event)">
      <thead>
      <tr>
        <th nzAlign="center">{{'common.index' | translate}}</th>
        <th nzAlign="center" nzColumnKey="code" [nzSortFn]="true">{{'model.order.code' | translate}}</th>
        <th nzAlign="center">{{'model.order.orderer' | translate}}</th>
        <th nzAlign="center" mzColumnKey="createAt"  [nzSortFn]="true">{{'model.order.createdAt' | translate}}</th>
        <th nzAlign="center" nzColumnKey="total" [nzSortFn]="true">{{'model.order.totalPrice' | translate}}</th>
        <th nzAlign="center" nzColumnKey="purchaseType" [nzSortFn]="true">{{'model.order.type.root' | translate}}</th>
        <th nzAlign="center" nzColumnKey="paymentMethod" [nzSortFn]="true">{{'model.order.payment' | translate}}</th>
        <th nzAlign="center" nzColumnKey="status" [nzSortFn]="true">{{'model.order.status.root' | translate}}</th>
        <th nzAlign="center">{{'action.msg' | translate}}</th>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngFor="let item of orders; let i = index">
        <tr>
          <td nzAlign="center">{{ getIndex(i) }}</td>
          <td nzAlign="center">{{item.orderCode}}</td>
          <td nzAlign="center">{{item.user.fullName}}</td>
          <td nzAlign="center">{{item.createAt | date:"dd-MM-yyyy"}}</td>
          <td nzAlign="center">{{item.total ? (item.total | vnd) : "-"}}</td>
          <td nzAlign="center">{{getPurchaseType(item.purchaseType)}}</td>
          <td nzAlign="center">{{getpayment(item.paymentMethod)}}</td>
          <td nzAlign="center">
            <mb-badge [color]="getColor(item?.status)" [text]="getStatus(item?.status)"></mb-badge>
          </td>
        
          <td nzAlign="center">
            <mb-button-action [action]="'edit'" className="first" 
            nzTooltipTitle="{{ 'action.detail' | translate }}"
                nzTooltipPlacement="top"
                nz-tooltip (click)="detail(item)">
            </mb-button-action>
            <mb-button-action [action]="'received'" className="last" 
            nzTooltipTitle="{{'action.export' | translate}}"
                              nzTooltipPlacement="top"   nz-tooltip (click)="export(item.id)">
            </mb-button-action>
          </td>
        </tr>
      </ng-container>
      </tbody>
    </nz-table>
    <mb-pagination [pageIndex]="orderSearchRequest.pageIndex" [pageSize]="orderSearchRequest.pageSize" [total]="total"
                   (onChange)="onQuerySearch($event)">
    </mb-pagination>
  </div>
</div>
<ng-template #noDataResult>
  <mb-no-data></mb-no-data>
</ng-template>
